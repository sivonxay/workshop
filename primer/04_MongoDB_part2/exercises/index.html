<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Lessons for the Materials Project Workshop"><link href=https://workshop.materialsproject.org/primer/04_MongoDB_part2/exercises/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.1, mkdocs-material-7.1.8"><title>Exercises - The Materials Project Workshop</title><link rel=stylesheet href=../../../assets/stylesheets/main.ca7ac06f.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.f1a3b89f.min.css><meta name=theme-color content=#546d78><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/workshop.css><link rel=stylesheet href=../../../css/ansi-colours.css><link rel=stylesheet href=../../../css/jupyter-cells.css><link rel=stylesheet href=../../../css/pandas-dataframe.css></head> <body dir=ltr data-md-color-scheme data-md-color-primary=blue-grey data-md-color-accent> <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#mongodb-part-2-exercises class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="The Materials Project Workshop" class="md-header__button md-logo" aria-label="The Materials Project Workshop" data-md-component=logo> <img src=../../../assets/materials_project_logo_white.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> The Materials Project Workshop </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Exercises </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/materialsproject/workshop/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="The Materials Project Workshop" class="md-nav__button md-logo" aria-label="The Materials Project Workshop" data-md-component=logo> <img src=../../../assets/materials_project_logo_white.svg alt=logo> </a> The Materials Project Workshop </label> <div class=md-nav__source> <a href=https://github.com/materialsproject/workshop/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../../logistics/logistics/ class=md-nav__link> Logistics </a> </li> <li class=md-nav__item> <a href=../../../people/people/ class=md-nav__link> People </a> </li> <li class=md-nav__item> <a href=../../../code_of_conduct/ class=md-nav__link> Code of Conduct </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Primer <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Primer data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Primer </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../01_basic_python/0%20-%20Introduction%20and%20Jupyter%20Use/ class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../01_basic_python/1%20-%20Python%20Primer/ class=md-nav__link> Basic Python </a> </li> <li class=md-nav__item> <a href=../../02_building_logic/2%20-%20Python%20Primer%20-%20Part%20II/ class=md-nav__link> Advanced Python </a> </li> <li class=md-nav__item> <a href=../../03_MongoDB_part1/lessons/ class=md-nav__link> Intro to MongoDB </a> </li> <li class=md-nav__item> <a href=../lesson/ class=md-nav__link> Advanced MongoDB </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Workshop <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Workshop data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Workshop </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_1 type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1> Day 1 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Day 1" data-md-level=2> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> Day 1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../lessons/01_website_walkthrough/website_walkthrough/ class=md-nav__link> The Materials Project Website </a> </li> <li class=md-nav__item> <a href=../../../lessons/02_intro_pymatgen/1%20-%20pymatgen%20foundations/ class=md-nav__link> Intro to Pymatgen </a> </li> <li class=md-nav__item> <a href=../../../lessons/03_surfaces/Working%20With%20Surfaces_lesson/ class=md-nav__link> Working with Surfaces </a> </li> <li class=md-nav__item> <a href=../../../lessons/04_materials_api/api_use/ class=md-nav__link> The Materials API </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_2 type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2> Day 2 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Day 2" data-md-level=2> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> Day 2 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../lessons/05_automated_dft/Lesson/ class=md-nav__link> Automated DFT </a> </li> <li class=md-nav__item> <a href=../../../lessons/06_new_systems/06%20-%20New%20Systems%20-%20filled/ class=md-nav__link> Exploring New Systems </a> </li> <li class=md-nav__item> <a href=../../../lessons/07_mpcontribs/contribute/ class=md-nav__link> MPContribs </a> </li> <li class=md-nav__item> <a href=../../../lessons/08_ml_matminer/matminer-notes/ class=md-nav__link> Machine Learning with MatMiner </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-working-with-distinct-values-elemmatch-and-regex class=md-nav__link> 1: Working with Distinct Values, $elemMatch, and Regex </a> <nav class=md-nav aria-label="1: Working with Distinct Values, $elemMatch, and Regex"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#never-from-there-but-sometimes-there-at-last class=md-nav__link> Never from there, but sometimes there at last </a> </li> <li class=md-nav__item> <a href=#countries-of-affiliation class=md-nav__link> Countries of affiliation </a> </li> <li class=md-nav__item> <a href=#triple-plays-mostly-all-around class=md-nav__link> Triple plays (mostly) all around </a> </li> <li class=md-nav__item> <a href=#other-sharing-after-world-war-ii class=md-nav__link> Other sharing after World War II </a> </li> <li class=md-nav__item> <a href=#organizations-and-prizes-over-time class=md-nav__link> Organizations and prizes over time </a> </li> <li class=md-nav__item> <a href=#germany-then-and-now class=md-nav__link> Germany, then and now </a> </li> <li class=md-nav__item> <a href=#the-prized-transistor class=md-nav__link> The prized transistor </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-projection-and-sorting class=md-nav__link> 2: Projection and Sorting </a> <nav class=md-nav aria-label="2: Projection and Sorting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#rounding-up-the-gs-crew class=md-nav__link> Rounding up the G.S. crew </a> </li> <li class=md-nav__item> <a href=#sorting-together-mongodb-python class=md-nav__link> Sorting together: MongoDB + Python </a> </li> <li class=md-nav__item> <a href=#gap-years class=md-nav__link> Gap years </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-indexing class=md-nav__link> 3: Indexing </a> <nav class=md-nav aria-label="3: Indexing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#an-index-for-high-share-categories class=md-nav__link> An index for high-share categories </a> </li> <li class=md-nav__item> <a href=#recently-single class=md-nav__link> Recently single? </a> </li> <li class=md-nav__item> <a href=#born-and-affiliated class=md-nav__link> Born and affiliated </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/materialsproject/workshop/edit/master/docs/primer/04_MongoDB_part2/exercises.ipynb title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <script src=https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js></script> <script>
(function() {
  function addWidgetsRenderer() {
    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var scriptElement = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    scriptElement.src = widgetRendererSrc;
    document.body.appendChild(scriptElement);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h1 id=mongodb-part-2-exercises>MongoDB Part 2 Exercises<a class=headerlink href=#mongodb-part-2-exercises title="Permanent link">&para;</a></h1> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h2 id=1-working-with-distinct-values-elemmatch-and-regex>1: Working with Distinct Values, $elemMatch, and Regex<a class=headerlink href=#1-working-with-distinct-values-elemmatch-and-regex title="Permanent link">&para;</a></h2> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pymongo</span> <span class=kn>import</span> <span class=n>MongoClient</span>

<span class=n>client</span> <span class=o>=</span> <span class=n>MongoClient</span><span class=p>()</span>
<span class=n>db</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>nobel</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=never-from-there-but-sometimes-there-at-last>Never from there, but sometimes there at last<a class=headerlink href=#never-from-there-but-sometimes-there-at-last title="Permanent link">&para;</a></h3> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>There are some recorded countries of death (<code>"diedCountry"</code>) that do not appear as a country of birth (<code>"bornCountry"</code>) for laureates. One such country is "East Germany".</p> <ul> <li>Return a set of all such countries as <code>countries</code>.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Countries recorded as countries of death but not as countries of birth</span>
<span class=n>countries</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>____</span><span class=p>)</span> <span class=o>-</span> <span class=nb>set</span><span class=p>(</span><span class=n>____</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>countries</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=countries-of-affiliation>Countries of affiliation<a class=headerlink href=#countries-of-affiliation title="Permanent link">&para;</a></h3> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>We saw in the last exercise that countries can be associated with a laureate as their country of birth and as their country of death. For each prize a laureate received, they may also have been affiliated with an institution at the time, located in a country.</p> <ul> <li>Determine the number of distinct countries recorded as part of an affiliation for laureates' prizes. Save this as <code>count</code>.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># The number of distinct countries of laureate affiliation for prizes</span>
<span class=n>count</span> <span class=o>=</span> <span class=n>____</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>____</span><span class=p>(</span><span class=n>____</span><span class=p>))</span>
<span class=nb>print</span><span class=p>(</span><span class=n>count</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=triple-plays-mostly-all-around>Triple plays (mostly) all around<a class=headerlink href=#triple-plays-mostly-all-around title="Permanent link">&para;</a></h3> <p>All prize categories but one – literature – have had prizes shared by three or more laureates.</p> <ul> <li>Save a filter document <code>criteria</code> that, when passed to <code>db.prizes.distinct</code>, returns all prize categories shared by three or more laureates. That is, <code>"laureates.2"</code> must exist for such documents.</li> <li>Save these prize categories as a Python <code>set</code> called <code>triple_play_categories</code>.</li> <li>Confirm via an assertion that "literature" is the only prize category with no prizes shared by three or more laureates.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Save a filter for prize documents with three or more laureates</span>
<span class=n>criteria</span> <span class=o>=</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=n>____</span><span class=p>}}</span>

<span class=c1># Save the set of distinct prize categories in documents satisfying the criteria</span>
<span class=n>triple_play_categories</span> <span class=o>=</span> <span class=n>____</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span><span class=n>____</span><span class=p>,</span> <span class=n>criteria</span><span class=p>))</span>

<span class=c1># Confirm literature as the only category not satisfying the criteria.</span>
<span class=k>assert</span> <span class=nb>set</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span><span class=n>____</span><span class=p>))</span> <span class=o>-</span> <span class=n>triple_play_categories</span> <span class=o>==</span> <span class=p>{</span><span class=n>____</span><span class=p>}</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=other-sharing-after-world-war-ii>Other sharing after World War II<a class=headerlink href=#other-sharing-after-world-war-ii title="Permanent link">&para;</a></h3> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Similar to the example in the lesson, what is the approximate ratio of the number of laureates who won an <em>unshared</em> prize in categories other than physics, chemistry, and medicine after World War II to the number of laureates who won a <em>shared</em> prize in categories other than physics, chemistry, and medicine after World War II?</p> <ul> <li>Save an <code>$elemMatch</code> filter <code>unshared</code> to count laureates with unshared prizes in categories other than ("not in") <code>["physics", "chemistry", "medicine"]</code> in or after 1945.</li> <li>Save an <code>$elemMatch</code> filter <code>shared</code> to count laureates with shared (i.e., "share" is not "1") prizes in categories other than <code>["physics", "chemistry", "medicine"]</code> in or after 1945.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Save a filter for laureates with unshared prizes</span>
<span class=n>unshared</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s2>&quot;prizes&quot;</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=p>{</span>
        <span class=n>____</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;physics&quot;</span><span class=p>,</span> <span class=s2>&quot;chemistry&quot;</span><span class=p>,</span> <span class=s2>&quot;medicine&quot;</span><span class=p>]},</span>
        <span class=s2>&quot;share&quot;</span><span class=p>:</span> <span class=s2>&quot;1&quot;</span><span class=p>,</span>
        <span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=s2>&quot;1945&quot;</span><span class=p>},</span>
    <span class=p>}}}</span>

<span class=c1># Save a filter for laureates with shared prizes</span>
<span class=n>shared</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s2>&quot;prizes&quot;</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=p>{</span>
        <span class=n>____</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;physics&quot;</span><span class=p>,</span> <span class=s2>&quot;chemistry&quot;</span><span class=p>,</span> <span class=s2>&quot;medicine&quot;</span><span class=p>]},</span>
        <span class=s2>&quot;share&quot;</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=s2>&quot;1&quot;</span><span class=p>},</span>
        <span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=s2>&quot;1945&quot;</span><span class=p>},</span>
    <span class=p>}}}</span>

<span class=n>ratio</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>____</span><span class=p>(</span><span class=n>____</span><span class=p>)</span> <span class=o>/</span> <span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>____</span><span class=p>(</span><span class=n>____</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>ratio</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=organizations-and-prizes-over-time>Organizations and prizes over time<a class=headerlink href=#organizations-and-prizes-over-time title="Permanent link">&para;</a></h3> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>How many organizations won prizes before 1945 versus in or after 1945?</p> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <ul> <li>Save a filter <code>before</code> to count organization laureates with prizes won before 1945. Recall that organization status is encoded with the "gender" field, and that dot notation is needed to access a laureate's "year" field within its "prizes" array.</li> <li>Save a filter <code>in_or_after</code> to count organization laureates with prizes won in or after 1945.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Save a filter for organization laureates with prizes won before 1945</span>
<span class=n>before</span> <span class=o>=</span> <span class=p>{</span>
    <span class=n>____</span><span class=p>:</span> <span class=n>____</span><span class=p>,</span>
    <span class=n>____</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=s2>&quot;1945&quot;</span><span class=p>},</span>
    <span class=p>}</span>

<span class=c1># Save a filter for organization laureates with prizes won in or after 1945</span>
<span class=n>in_or_after</span> <span class=o>=</span> <span class=p>{</span>
    <span class=n>____</span><span class=p>:</span> <span class=n>____</span><span class=p>,</span>
    <span class=n>____</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=s2>&quot;1945&quot;</span><span class=p>},</span>
    <span class=p>}</span>

<span class=n>n_before</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>count_documents</span><span class=p>(</span><span class=n>before</span><span class=p>)</span>
<span class=n>n_in_or_after</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>count_documents</span><span class=p>(</span><span class=n>in_or_after</span><span class=p>)</span>
<span class=n>ratio</span> <span class=o>=</span> <span class=n>n_in_or_after</span> <span class=o>/</span> <span class=p>(</span><span class=n>n_in_or_after</span> <span class=o>+</span> <span class=n>n_before</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>ratio</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=germany-then-and-now>Germany, then and now<a class=headerlink href=#germany-then-and-now title="Permanent link">&para;</a></h3> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Just as we saw with Poland, there are laureates who were born somewhere that was in Germany at the time but is now not, and others born somewhere that was not in Germany at the time but now is.</p> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <ul> <li>Use a regular expression object to filter for laureates with "Germany" in their "bornCountry" value.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Filter for laureates with &quot;Germany&quot; in their &quot;bornCountry&quot; value</span>
<span class=n>criteria</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;bornCountry&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$regex&quot;</span><span class=p>:</span> <span class=n>____</span><span class=p>}}</span>
<span class=nb>print</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span><span class=s2>&quot;bornCountry&quot;</span><span class=p>,</span> <span class=n>criteria</span><span class=p>)))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <ul> <li>Use a regular expression object to filter for laureates with a "bornCountry" value starting with "Germany".</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Filter for laureates with a &quot;bornCountry&quot; value starting with &quot;Germany&quot;</span>
<span class=n>criteria</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;bornCountry&quot;</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span><span class=n>____</span><span class=p>}}</span>
<span class=nb>print</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span><span class=s2>&quot;bornCountry&quot;</span><span class=p>,</span> <span class=n>criteria</span><span class=p>)))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <ul> <li>Use a regular expression object to filter for laureates born in what was at the time Germany but is now another country.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Fill in a string value to be sandwiched between the strings &quot;^&quot; and &quot;now&quot;</span>
<span class=n>criteria</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;bornCountry&quot;</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span><span class=s2>&quot;^&quot;</span> <span class=o>+</span> <span class=n>____</span> <span class=o>+</span> <span class=s2>&quot;now&quot;</span><span class=p>}}</span>
<span class=nb>print</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span><span class=s2>&quot;bornCountry&quot;</span><span class=p>,</span> <span class=n>criteria</span><span class=p>)))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <ul> <li>Use a regular expression object to filter for laureates born in what is now Germany but at the time was another country.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Filter for currently-Germany countries of birth.</span>
<span class=c1># Fill in a string value to be sandwiched between the strings &quot;now&quot; and &quot;$&quot;</span>
<span class=n>criteria</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;bornCountry&quot;</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span><span class=s2>&quot;now&quot;</span> <span class=o>+</span> <span class=n>____</span> <span class=o>+</span> <span class=s2>&quot;$&quot;</span><span class=p>}}</span>
<span class=nb>print</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span><span class=s2>&quot;bornCountry&quot;</span><span class=p>,</span> <span class=n>criteria</span><span class=p>)))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=the-prized-transistor>The prized transistor<a class=headerlink href=#the-prized-transistor title="Permanent link">&para;</a></h3> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>Three people shared a Nobel prize "for their researches on semiconductors and their discovery of the transistor effect". We can filter on "transistor" as a substring of a laureate's "prizes.motivation" field value to find these laureates.</p> <ul> <li>Save a filter <code>criteria</code> that finds laureates with <code>prizes.motivation</code> values containing "transistor" as a substring. The substring can appear anywhere within the value, so no anchoring characters are needed.</li> <li>Save to <code>first</code> and <code>last</code> the field names corresponding to a laureate's first name and last name (i.e. "surname") so that we can print out the names of these laureates.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Save a filter for laureates with prize motivation values containing &quot;transistor&quot; as a substring</span>
<span class=n>criteria</span> <span class=o>=</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span><span class=n>____</span><span class=p>}}</span>

<span class=c1># Save the field names corresponding to a laureate&#39;s first name and last name</span>
<span class=n>first</span><span class=p>,</span> <span class=n>last</span> <span class=o>=</span> <span class=n>____</span><span class=p>,</span> <span class=n>____</span>
<span class=nb>print</span><span class=p>([(</span><span class=n>laureate</span><span class=p>[</span><span class=n>first</span><span class=p>],</span> <span class=n>laureate</span><span class=p>[</span><span class=n>last</span><span class=p>])</span> <span class=k>for</span> <span class=n>laureate</span> <span class=ow>in</span> <span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=n>criteria</span><span class=p>)])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h2 id=2-projection-and-sorting>2: Projection and Sorting<a class=headerlink href=#2-projection-and-sorting title="Permanent link">&para;</a></h2> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=rounding-up-the-gs-crew>Rounding up the G.S. crew<a class=headerlink href=#rounding-up-the-gs-crew title="Permanent link">&para;</a></h3> <p>We can use the regular expression operator <code>$regex</code> to find laureates whose initials are G.S. Let's use projection and list comprehension to collect the full names of these laureates by concatenating their first ("firstname") and last ("surname") names.</p> <ul> <li>Fill in the blanks to save a list <code>names</code> of full names ("firstname" plus "surname") of laureates with initials G.S. (ignoring middles names/initials). You'll need to both filter on names as well as project out the fields required to collect the full names.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Collect a list of full names</span>
<span class=n>names</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot; &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>doc</span><span class=p>[</span><span class=n>____</span><span class=p>],</span> <span class=n>doc</span><span class=p>[</span><span class=n>____</span><span class=p>]])</span>
         <span class=k>for</span> <span class=n>doc</span> <span class=ow>in</span> <span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>find</span><span class=p>(</span>
             <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$regex&quot;</span><span class=p>:</span> <span class=s2>&quot;^G&quot;</span><span class=p>},</span>
              <span class=n>____</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$regex&quot;</span><span class=p>:</span> <span class=s2>&quot;^S&quot;</span><span class=p>}},</span>
             <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>____</span><span class=p>:</span> <span class=mi>1</span><span class=p>})]</span>
<span class=nb>print</span><span class=p>(</span><span class=n>names</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=sorting-together-mongodb-python>Sorting together: MongoDB + Python<a class=headerlink href=#sorting-together-mongodb-python title="Permanent link">&para;</a></h3> <p>You will print out the names of all physics laureates, with one line printed for each award year, in chronological order. Each line will list laureates for that year in alphabetical order by surname ("last" name).</p> <p>I encourage you to print intermediate results and understand the nested structure of prize documents.</p> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <ul> <li>Construct a sort specification <code>sort_spec</code> to fetch physics prizes by ascending year.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>operator</span> <span class=kn>import</span> <span class=n>itemgetter</span>

<span class=c1># Sort by ascending year</span>
<span class=n>sort_spec</span> <span class=o>=</span> <span class=p>[(</span><span class=n>____</span><span class=p>,</span> <span class=n>____</span><span class=p>)]</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <ul> <li>Use <code>&lt;collection&gt;.find</code> to construct a <code>cursor</code> that fetches prizes with a "category" of "physics", sorts by ascending year, and projects the year and first laureate full name (<code>laureates.firstname</code> and <code>laureates.surname</code>). <em>You should encounter an error at year 1916</em>.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Construct a cursor over physics prizes</span>
<span class=n>cursor</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>____</span><span class=p>({</span><span class=n>____</span><span class=p>:</span> <span class=n>____</span><span class=p>},</span> 
                        <span class=p>{</span><span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;laureates.firstname&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;laureates.surname&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>},</span>
                        <span class=n>sort</span><span class=o>=</span><span class=n>sort_spec</span><span class=p>)</span>

<span class=k>for</span> <span class=n>doc</span> <span class=ow>in</span> <span class=n>cursor</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{year}</span><span class=s2>: </span><span class=si>{first_laureate_firstname}</span><span class=s2> </span><span class=si>{first_laureate_surname}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=n>year</span><span class=o>=</span><span class=n>doc</span><span class=p>[</span><span class=s2>&quot;year&quot;</span><span class=p>],</span>
        <span class=n>first_laureate_firstname</span><span class=o>=</span><span class=n>doc</span><span class=p>[</span><span class=s2>&quot;laureates&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s2>&quot;firstname&quot;</span><span class=p>],</span>
        <span class=n>first_laureate_surname</span><span class=o>=</span><span class=n>doc</span><span class=p>[</span><span class=s2>&quot;laureates&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s2>&quot;surname&quot;</span><span class=p>]))</span>
<span class=n>cursor</span><span class=o>.</span><span class=n>rewind</span><span class=p>()</span> <span class=c1># Rewind cursor to reuse in the next step</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <ul> <li>The error is caused by the fact that the Nobel Prize in physics was not awarded in 1916 due to World War I. Supplement the cursor's filter to avoid the error:</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Construct a fixed cursor over physics prizes</span>
<span class=n>cursor</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>____</span><span class=p>({</span><span class=n>____</span><span class=p>:</span> <span class=n>____</span><span class=p>,</span> <span class=n>____</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span><span class=kc>True</span><span class=p>}},</span> 
                        <span class=p>{</span><span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;laureates.firstname&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;laureates.surname&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>},</span>
                        <span class=n>sort</span><span class=o>=</span><span class=n>sort_spec</span><span class=p>)</span>

<span class=k>for</span> <span class=n>doc</span> <span class=ow>in</span> <span class=n>cursor</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{year}</span><span class=s2>: </span><span class=si>{first_laureate_firstname}</span><span class=s2> </span><span class=si>{first_laureate_surname}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=n>year</span><span class=o>=</span><span class=n>doc</span><span class=p>[</span><span class=s2>&quot;year&quot;</span><span class=p>],</span>
        <span class=n>first_laureate_firstname</span><span class=o>=</span><span class=n>doc</span><span class=p>[</span><span class=s2>&quot;laureates&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s2>&quot;firstname&quot;</span><span class=p>],</span>
        <span class=n>first_laureate_surname</span><span class=o>=</span><span class=n>doc</span><span class=p>[</span><span class=s2>&quot;laureates&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s2>&quot;surname&quot;</span><span class=p>]))</span>
<span class=n>cursor</span><span class=o>.</span><span class=n>rewind</span><span class=p>()</span> <span class=c1># Rewind cursor to reuse in the next step</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <ul> <li>Complete the definition of the function <code>names</code> so that, given a prize document, it returns a list of formatted names, sorted by ascending "surname", for each of the "laureates" in that prize document.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Define a function names() to return a list of formatted names</span>
<span class=k>def</span> <span class=nf>names</span><span class=p>(</span><span class=n>doc</span><span class=p>):</span>
    <span class=n>formatted_names</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;</span><span class=si>{firstname}</span><span class=s2> </span><span class=si>{surname}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=o>**</span><span class=n>laureate</span><span class=p>)</span>
          <span class=k>for</span> <span class=n>laureate</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>doc</span><span class=p>[</span><span class=n>____</span><span class=p>],</span> <span class=n>key</span><span class=o>=</span><span class=n>itemgetter</span><span class=p>(</span><span class=n>____</span><span class=p>))]</span>
    <span class=k>return</span> <span class=n>formatted_names</span>

<span class=n>lines</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;</span><span class=si>{year}</span><span class=s2>: </span><span class=si>{names}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>year</span><span class=o>=</span><span class=n>doc</span><span class=p>[</span><span class=s2>&quot;year&quot;</span><span class=p>],</span> <span class=n>names</span><span class=o>=</span><span class=s2>&quot; and &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>names</span><span class=p>(</span><span class=n>doc</span><span class=p>)))</span>
         <span class=k>for</span> <span class=n>doc</span> <span class=ow>in</span> <span class=n>cursor</span><span class=p>]</span>
<span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>lines</span><span class=p>:</span> <span class=nb>print</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=gap-years>Gap years<a class=headerlink href=#gap-years title="Permanent link">&para;</a></h3> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>As we saw above, there have been years for which prizes in one or more of the original categories were not awarded.</p> <p>Sorting first by reverse chronological order and second by alphabetical order of category, collect and format prize documents to produce one formatted entry per year listing categories missing for that year.</p> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <ul> <li>Construct a set <code>original_categories</code> of prize categories awarded in 1901.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>itertools</span>
<span class=kn>from</span> <span class=nn>operator</span> <span class=kn>import</span> <span class=n>itemgetter</span>

<span class=c1># Save the set of prize categories awarded in 1901</span>
<span class=n>original_categories</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>____</span><span class=p>(</span><span class=s2>&quot;category&quot;</span><span class=p>,</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=s2>&quot;1901&quot;</span><span class=p>}))</span>
<span class=nb>print</span><span class=p>(</span><span class=n>original_categories</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <ul> <li>Use <code>&lt;collection&gt;.find</code> to construct a cursor that yields prize documents only for categories in the list of original categories which contain the <code>laureates</code> key and thus were awarded, sorted first by decreasing year and second by increasing category.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Construct a cursor over original-category prizes</span>
<span class=n>cursor</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>____</span><span class=p>({</span><span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=nb>list</span><span class=p>(</span><span class=n>original_categories</span><span class=p>)},</span> <span class=n>____</span><span class=p>:</span> <span class=p>{</span><span class=n>____</span><span class=p>:</span><span class=n>____</span><span class=p>}},</span>
                        <span class=p>{</span><span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>},</span>
                        <span class=n>sort</span><span class=o>=</span><span class=p>[(</span><span class=n>____</span><span class=p>,</span> <span class=n>____</span><span class=p>),</span> <span class=p>(</span><span class=n>____</span><span class=p>,</span> <span class=n>____</span><span class=p>)])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <ul> <li>Collect a list <code>not_awarded</code> of entries to be printed, one per line, that displays a year and the categories missing for that year. You will collect "category" values for each year and set-subtract them from the original categories.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Collect entries for missing prize categories</span>
<span class=n>not_awarded</span> <span class=o>=</span> <span class=p>[]</span>
<span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>group</span> <span class=ow>in</span> <span class=n>itertools</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>cursor</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=n>itemgetter</span><span class=p>(</span><span class=s2>&quot;year&quot;</span><span class=p>)):</span>
    <span class=n>year_categories</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>prize</span><span class=p>[</span><span class=n>____</span><span class=p>]</span> <span class=k>for</span> <span class=n>prize</span> <span class=ow>in</span> <span class=n>group</span><span class=p>)</span>
    <span class=n>missing</span> <span class=o>=</span> <span class=s2>&quot;, &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>sorted</span><span class=p>(</span><span class=n>____</span> <span class=o>-</span> <span class=n>____</span><span class=p>))</span>
    <span class=k>if</span> <span class=n>missing</span><span class=p>:</span> <span class=n>not_awarded</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2>: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>missing</span><span class=p>))</span>

<span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>not_awarded</span><span class=p>:</span> <span class=nb>print</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h2 id=3-indexing>3: Indexing<a class=headerlink href=#3-indexing title="Permanent link">&para;</a></h2> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=an-index-for-high-share-categories>An index for high-share categories<a class=headerlink href=#an-index-for-high-share-categories title="Permanent link">&para;</a></h3> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <p>We want to speed up the following operation: <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span><span class=s2>&quot;category&quot;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&quot;laureates.share&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$gt&quot;</span><span class=p>:</span> <span class=s2>&quot;3&quot;</span><span class=p>}})</span>
</code></pre></div> - Confirm that the operation takes approximately 1 ms without an index.</p> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <ul> <li>Specify a compound index model <code>index_model</code> to pass to <code>db.prizes.create_index</code>.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>index_model</span> <span class=o>=</span> <span class=p>[(</span><span class=n>____</span><span class=p>,</span><span class=n>____</span><span class=p>),</span> <span class=p>(</span><span class=n>____</span><span class=p>,</span><span class=n>____</span><span class=p>)]</span>
<span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>create_index</span><span class=p>(</span><span class=n>index_model</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <ul> <li>Confirm that the execution time is now below 400 µs.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Drop the index for consistency</span>
<span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>drop_index</span><span class=p>(</span><span class=n>index_model</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=recently-single>Recently single?<a class=headerlink href=#recently-single title="Permanent link">&para;</a></h3> <p>A prize might be awarded to a single laureate or to several. For each prize category, report the most recent year that a single laureate -- rather than several -- received a prize in that category.</p> <ul> <li>Specify an index model <code>index_model</code> to pass to <code>db.prizes.create_index</code> that speeds up finding prizes by category and sorting results by decreasing year. That is, the model should index first on category (ascending) and second on year (descending).</li> <li>Save a string <code>report</code> for printing the last single-laureate year for each distinct category, one category per line. To do this, for each distinct prize category, find the latest-year prize of that category with a laureate share of "1".</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Specify an index model for compound sorting</span>
<span class=n>index_model</span> <span class=o>=</span> <span class=p>[(</span><span class=n>____</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=p>(</span><span class=n>____</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)]</span>
<span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>create_index</span><span class=p>(</span><span class=n>index_model</span><span class=p>)</span>

<span class=c1># Collect the last single-laureate year for each category</span>
<span class=n>report</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
<span class=k>for</span> <span class=n>category</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>____</span><span class=p>(</span><span class=s2>&quot;category&quot;</span><span class=p>)):</span>
    <span class=n>doc</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find_one</span><span class=p>(</span>
        <span class=p>{</span><span class=n>____</span><span class=p>:</span> <span class=n>____</span><span class=p>,</span> <span class=s2>&quot;laureates.share&quot;</span><span class=p>:</span> <span class=s2>&quot;1&quot;</span><span class=p>},</span>
        <span class=n>sort</span><span class=o>=</span><span class=p>[(</span><span class=n>____</span><span class=p>,</span> <span class=n>____</span><span class=p>)]</span>
    <span class=p>)</span>
    <span class=n>report</span> <span class=o>+=</span> <span class=s2>&quot;</span><span class=si>{category}</span><span class=s2>: </span><span class=si>{year}</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=o>**</span><span class=n>doc</span><span class=p>)</span>

<span class=nb>print</span><span class=p>(</span><span class=n>report</span><span class=p>)</span>

<span class=c1># Drop the index for consistency</span>
<span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>drop_index</span><span class=p>(</span><span class=n>index_model</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <div class=inner_cell> <div class="text_cell_render border-box-sizing rendered_html"> <h3 id=born-and-affiliated>Born and affiliated<a class=headerlink href=#born-and-affiliated title="Permanent link">&para;</a></h3> <p>Some countries are, for one or more laureates, both their country of birth ("bornCountry") and a country of affiliation for one or more of their prizes ("prizes.affiliations.country"). You will find the five countries of birth with the highest counts of such laureates.</p> <ul> <li>Create an index on country of birth ("bornCountry") for <code>db.laureates</code> to ensure efficient gathering of distinct values and counting of documents</li> <li>Complete the skeleton dictionary comprehension to construct <code>n_born_and_affiliated</code>, the count of laureates as described above for each distinct country of birth.</li> </ul> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>Counter</span>

<span class=c1># Ensure an index on country of birth</span>
<span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>create_index</span><span class=p>([(</span><span class=n>____</span><span class=p>,</span> <span class=mi>1</span><span class=p>)])</span>

<span class=c1># Collect a count of laureates for each country of birth</span>
<span class=n>n_born_and_affiliated</span> <span class=o>=</span> <span class=p>{</span>
    <span class=n>country</span><span class=p>:</span> <span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>count_documents</span><span class=p>({</span>
        <span class=n>____</span><span class=p>:</span> <span class=n>____</span><span class=p>,</span>
        <span class=s2>&quot;prizes.affiliations.country&quot;</span><span class=p>:</span> <span class=n>____</span>
    <span class=p>})</span>
    <span class=k>for</span> <span class=n>____</span> <span class=ow>in</span> <span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span><span class=s2>&quot;bornCountry&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=n>five_most_common</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span><span class=n>n_born_and_affiliated</span><span class=p>)</span><span class=o>.</span><span class=n>most_common</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>five_most_common</span><span class=p>)</span>

<span class=c1># Drop the index for consistency</span>
<span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>drop_index</span><span class=p>([(</span><span class=n>____</span><span class=p>,</span> <span class=mi>1</span><span class=p>)])</span>
</code></pre></div> </div> </div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Built by The Materials Project </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["instant", "tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.b0710199.min.js", "version": null}</script> <script src=../../../assets/javascripts/bundle.76f349be.min.js></script> <script src=../../../assets/config.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>